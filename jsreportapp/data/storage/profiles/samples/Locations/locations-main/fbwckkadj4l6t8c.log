{"type":"operationStart","subtype":"profile","data":{"_id":"s9Osf9S6tVLzvUM6","timestamp":"2024-01-15T18:25:05.638Z","state":"queued","mode":"standard","creationDate":"2024-01-15T18:25:05.641Z","modificationDate":"2024-01-15T18:25:05.641Z","shortid":"tvaRtg1","$entitySet":"profiles"},"doDiffs":false,"timestamp":1705343105639,"id":"axr4teecv2nog4f","previousOperationId":null,"operationId":"tat7qyi4abhtysr"}
{"type":"log","level":"info","message":"Render request 30 queued for execution and waiting for available worker","previousOperationId":"tat7qyi4abhtysr","timestamp":1705343105639,"id":"umh2f11acxnmg07"}
{"type":"operationStart","subtype":"render","name":"locations-main","previousOperationId":"tat7qyi4abhtysr","timestamp":1705343105655,"id":"un0htm24erqt3if","previousEventId":"axr4teecv2nog4f","operationId":"u0xyjtb6idwnemv"}
{"type":"log","timestamp":1705343105655,"level":"info","message":"Starting rendering request 30","meta":{"rootId":"fbwckkadj4l6t8c","id":"fbwckkadj4l6t8c"},"id":"s4avjzof3rsouec","previousOperationId":"u0xyjtb6idwnemv"}
{"type":"log","timestamp":1705343105655,"level":"info","message":"Rendering template { name: locations-main, recipe: chrome-pdf, engine: handlebars, preview: true }","meta":{"rootId":"fbwckkadj4l6t8c","id":"fbwckkadj4l6t8c"},"id":"0ej9pq8a5lvk47k","previousOperationId":"u0xyjtb6idwnemv"}
{"type":"log","timestamp":1705343105656,"level":"debug","message":"Data item not defined for this template.","meta":{"rootId":"fbwckkadj4l6t8c","id":"fbwckkadj4l6t8c"},"id":"0omcorapqwm3k4v","previousOperationId":"u0xyjtb6idwnemv"}
{"type":"log","timestamp":1705343105661,"level":"debug","message":"Executing script locations-script (beforeRender)","meta":{"rootId":"fbwckkadj4l6t8c","id":"fbwckkadj4l6t8c"},"id":"d6vojqruazxa48n","previousOperationId":"u0xyjtb6idwnemv"}
{"type":"log","timestamp":1705343105674,"level":"warn","message":"Error when processing render request 30\n(because) error when evaluating custom script /samples/Locations/locations-script\nPrivate field '#each' must be declared in an enclosing class\nsandbox.js:64\n    {{#each locations}}\n     ^\n\nSyntaxError: Private field '#each' must be declared in an enclosing class\n    at new Script (node:vm:94:7)\n    at doCompileScript (C:\\Users\\arida\\Dev\\2DAM\\EventFlow\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:154:10)\n    at run (C:\\Users\\arida\\Dev\\2DAM\\EventFlow\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:135:74)\n    at WorkerReporter.runInSandbox [as _runInSandbox] (C:\\Users\\arida\\Dev\\2DAM\\EventFlow\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\runInSandbox.js:195:20)","meta":{"rootId":"fbwckkadj4l6t8c","id":"fbwckkadj4l6t8c"},"id":"vy3qno97e43edja","previousOperationId":"u0xyjtb6idwnemv"}
{"type":"log","timestamp":1705343105675,"level":"warn","message":"Rendering request 30 finished with error in 38 ms","meta":{"rootId":"fbwckkadj4l6t8c","id":"fbwckkadj4l6t8c"},"id":"1y9yftpq3qbq4fs","previousOperationId":"u0xyjtb6idwnemv"}
{"type":"error","timestamp":1705343105682,"statusCode":400,"weak":true,"entity":{"shortid":"BJX1Jw82ce","name":"locations-script","content":"// server side script fetching remote data and preparing report data source\nconst http = require(\"http\");\n\n// call remote http rest api\nfunction fetchLocations() {\n  return new Promise((resolve, reject) => {\n    http.get(\n      \"http://localhost:8080/api/locations/count-localizaciones\",\n      (result) => {\n        let str = \"\";\n\n        result.on(\"data\", (chunk) => {\n          str += chunk;\n        });\n\n        result.on(\"error\", (err) => {\n          reject(err);\n        });\n\n        result.on(\"end\", () => {\n          try {\n            const parsedData = JSON.parse(str);\n            // Verificar que 'localizaciones' existe en la respuesta JSON\n            if (parsedData && parsedData.localizaciones) {\n              resolve(parsedData.localizaciones);\n            } else {\n              reject(\n                new Error(\"El formato de la respuesta no es el esperado.\")\n              );\n            }\n          } catch (error) {\n            reject(error);\n          }\n        });\n      }\n    );\n  });\n}\n\n// group the data for report\nasync function prepareDataSource() {\n  try {\n    const locations = await fetchLocations();\n    const source = locations.map((location) => ({\n      name: location.name,\n      numEventos: location.numEvento,\n    }));\n    console.log(\"adiossssssssssssssssssssssssssssssssssssssss\")\n    return source;\n  } catch (error) {\n    console.error(\"Error al obtener ubicaciones:\", error.message);\n    throw error;\n  }\n}\n\n// add jsreport hook which modifies the report input data\nasync function beforeRender(req, res) {\n  req.data.locations = await prepareDataSource();\n  grafico();\n}\n\nfunction grafico(){\n    var eventsByLocationsData = [];\n    {{#each locations}}\n    \n      var name = '{{name}}';\n      var numEvents = {{numEvents}};\n      eventsByLocationsData.push({ name: name, numEvents: numEvents });\n      console.log(name); // Imprime el nombre en la consola\n    {{/each}}\n\n    var labels = eventsByLocationsData.map(entry => entry.name);\n    var data = eventsByLocationsData.map(entry => entry.numEvents);\n\n    // Configuración del gráfico de barras\n    var ctx = document.getElementById('eventsLocations').getContext('2d');\n    var eventsLocationsChart = new Chart(ctx, {\n        type: 'bar',\n        data: {\n            labels: labels,\n            datasets: [{\n                label: 'Total de eventos',\n                backgroundColor: 'rgba(75, 192, 192, 0.2)',\n                borderColor: 'rgba(75, 192, 192, 1)',\n                borderWidth: 1,\n                data: data\n            }]\n        },\n        options: {\n            animation: { duration: 0 },\n            scales: {\n                yAxes: [{\n                    ticks: {\n                        beginAtZero: true\n                    }\n                }]\n            }\n        }\n    });\n}\n"},"property":"content","logged":true,"previousOperationId":"u0xyjtb6idwnemv","id":"o9c025v41tmyv0b","stack":"sandbox.js:64\n    {{#each locations}}\n     ^\n\nSyntaxError: Private field '#each' must be declared in an enclosing class\n    at new Script (node:vm:94:7)\n    at doCompileScript (C:\\Users\\arida\\Dev\\2DAM\\EventFlow\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:154:10)\n    at run (C:\\Users\\arida\\Dev\\2DAM\\EventFlow\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:135:74)\n    at WorkerReporter.runInSandbox [as _runInSandbox] (C:\\Users\\arida\\Dev\\2DAM\\EventFlow\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\runInSandbox.js:195:20)","message":"Error when evaluating custom script /samples/Locations/locations-script\nPrivate field '#each' must be declared in an enclosing class"}

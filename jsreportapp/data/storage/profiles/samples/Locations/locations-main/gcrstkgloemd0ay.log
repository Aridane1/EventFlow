{"type":"operationStart","subtype":"profile","data":{"_id":"mDnkRjYNnvmKA4Yi","timestamp":"2024-01-15T16:53:56.075Z","state":"queued","mode":"standard","creationDate":"2024-01-15T16:53:56.078Z","modificationDate":"2024-01-15T16:53:56.078Z","shortid":"DbAjH_K","$entitySet":"profiles"},"doDiffs":false,"timestamp":1705337636077,"id":"f7u2or1s5mq9v83","previousOperationId":null,"operationId":"1g7jkqacqlpocig"}
{"type":"log","level":"info","message":"Render request 29 queued for execution and waiting for available worker","previousOperationId":"1g7jkqacqlpocig","timestamp":1705337636077,"id":"ln69r1valqj39eg"}
{"type":"operationStart","subtype":"render","name":"locations-main","previousOperationId":"1g7jkqacqlpocig","timestamp":1705337636090,"id":"fihnqafk1ko8yc9","previousEventId":"f7u2or1s5mq9v83","operationId":"kacn8cx5vyoxgtv"}
{"type":"log","timestamp":1705337636090,"level":"info","message":"Starting rendering request 29","meta":{"rootId":"gcrstkgloemd0ay","id":"gcrstkgloemd0ay"},"id":"js1r613c0byqgg4","previousOperationId":"kacn8cx5vyoxgtv"}
{"type":"log","timestamp":1705337636090,"level":"info","message":"Rendering template { name: locations-main, recipe: chrome-pdf, engine: handlebars, preview: true }","meta":{"rootId":"gcrstkgloemd0ay","id":"gcrstkgloemd0ay"},"id":"tbadcoo3qhb48mg","previousOperationId":"kacn8cx5vyoxgtv"}
{"type":"log","timestamp":1705337636092,"level":"debug","message":"Data item not defined for this template.","meta":{"rootId":"gcrstkgloemd0ay","id":"gcrstkgloemd0ay"},"id":"xuoe3oxbmheasy1","previousOperationId":"kacn8cx5vyoxgtv"}
{"type":"log","timestamp":1705337636095,"level":"debug","message":"Executing script locations-script (beforeRender)","meta":{"rootId":"gcrstkgloemd0ay","id":"gcrstkgloemd0ay"},"id":"gconmrqy4uyzac4","previousOperationId":"kacn8cx5vyoxgtv"}
{"type":"log","timestamp":1705337636113,"level":"warn","message":"Error when processing render request 29\n(because) error when evaluating custom script /samples/Locations/locations-script\nPrivate field '#each' must be declared in an enclosing class\nsandbox.js:65\n    {{#each locations}}\n     ^\n\nSyntaxError: Private field '#each' must be declared in an enclosing class\n    at new Script (node:vm:94:7)\n    at doCompileScript (C:\\Users\\arida\\Dev\\2DAM\\EventFlow\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:154:10)\n    at run (C:\\Users\\arida\\Dev\\2DAM\\EventFlow\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:135:74)\n    at WorkerReporter.runInSandbox [as _runInSandbox] (C:\\Users\\arida\\Dev\\2DAM\\EventFlow\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\runInSandbox.js:195:20)","meta":{"rootId":"gcrstkgloemd0ay","id":"gcrstkgloemd0ay"},"id":"z6udbe0xgl8qjwo","previousOperationId":"kacn8cx5vyoxgtv"}
{"type":"log","timestamp":1705337636113,"level":"warn","message":"Rendering request 29 finished with error in 38 ms","meta":{"rootId":"gcrstkgloemd0ay","id":"gcrstkgloemd0ay"},"id":"uiiwl46g3mnurxb","previousOperationId":"kacn8cx5vyoxgtv"}
{"type":"error","timestamp":1705337636120,"statusCode":400,"weak":true,"entity":{"shortid":"BJX1Jw82ce","name":"locations-script","content":"// server side script fetching remote data and preparing report data source\nconst http = require(\"http\");\n\n// call remote http rest api\nfunction fetchLocations() {\n  return new Promise((resolve, reject) => {\n    http.get(\n      \"http://localhost:8080/api/locations/count-localizaciones\",\n      (result) => {\n        let str = \"\";\n\n        result.on(\"data\", (chunk) => {\n          str += chunk;\n        });\n\n        result.on(\"error\", (err) => {\n          reject(err);\n        });\n\n        result.on(\"end\", () => {\n          try {\n            const parsedData = JSON.parse(str);\n            // Verificar que 'localizaciones' existe en la respuesta JSON\n            if (parsedData && parsedData.localizaciones) {\n              resolve(parsedData.localizaciones);\n            } else {\n              reject(\n                new Error(\"El formato de la respuesta no es el esperado.\")\n              );\n            }\n          } catch (error) {\n            reject(error);\n          }\n        });\n      }\n    );\n  });\n}\n\n// group the data for report\nasync function prepareDataSource() {\n  try {\n    const locations = await fetchLocations();\n    const source = locations.map((location) => ({\n      name: location.name,\n      numEventos: location.numEvento,\n    }));\n    console.log(\"adiossssssssssssssssssssssssssssssssssssssss\")\n    return source;\n  } catch (error) {\n    console.error(\"Error al obtener ubicaciones:\", error.message);\n    throw error;\n  }\n}\n\n// add jsreport hook which modifies the report input data\nasync function beforeRender(req, res) {\n  req.data.locations = await prepareDataSource();\n  grafico();\n}\n\nfunction grafico(){\n    console.log(\"hola holitahhhhhhhhhhhhhhhhhhhhhhhhhhhhhh\")\n    var eventsByLocationsData = [];\n    {{#each locations}}\n      var name = '{{name}}';\n      var numEvents = {{numEvents}};\n      eventsByLocationsData.push({ name: name, numEvents: numEvents });\n      console.log(name); // Imprime el nombre en la consola\n    {{/each}}\n\n    var labels = eventsByLocationsData.map(entry => entry.name);\n    var data = eventsByLocationsData.map(entry => entry.numEvents);\n\n    // Configuración del gráfico de barras\n    var ctx = document.getElementById('eventsLocations').getContext('2d');\n    var eventsLocationsChart = new Chart(ctx, {\n        type: 'bar',\n        data: {\n            labels: labels,\n            datasets: [{\n                label: 'Total de eventos',\n                backgroundColor: 'rgba(75, 192, 192, 0.2)',\n                borderColor: 'rgba(75, 192, 192, 1)',\n                borderWidth: 1,\n                data: data\n            }]\n        },\n        options: {\n            animation: { duration: 0 },\n            scales: {\n                yAxes: [{\n                    ticks: {\n                        beginAtZero: true\n                    }\n                }]\n            }\n        }\n    });\n}\n"},"property":"content","logged":true,"previousOperationId":"kacn8cx5vyoxgtv","id":"zl0xilsmtox0ge9","stack":"sandbox.js:65\n    {{#each locations}}\n     ^\n\nSyntaxError: Private field '#each' must be declared in an enclosing class\n    at new Script (node:vm:94:7)\n    at doCompileScript (C:\\Users\\arida\\Dev\\2DAM\\EventFlow\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:154:10)\n    at run (C:\\Users\\arida\\Dev\\2DAM\\EventFlow\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:135:74)\n    at WorkerReporter.runInSandbox [as _runInSandbox] (C:\\Users\\arida\\Dev\\2DAM\\EventFlow\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\runInSandbox.js:195:20)","message":"Error when evaluating custom script /samples/Locations/locations-script\nPrivate field '#each' must be declared in an enclosing class"}

{"type":"operationStart","subtype":"profile","data":{"_id":"K4Ja8nBnaOTa6ZnT","timestamp":"2024-01-15T16:53:52.966Z","state":"queued","mode":"standard","creationDate":"2024-01-15T16:53:52.969Z","modificationDate":"2024-01-15T16:53:52.969Z","shortid":"Fb6Bw6o","$entitySet":"profiles"},"doDiffs":false,"timestamp":1705337632968,"id":"m9sppcvvs9r9kqn","previousOperationId":null,"operationId":"oifr6zqqo8yr4qz"}
{"type":"log","level":"info","message":"Render request 28 queued for execution and waiting for available worker","previousOperationId":"oifr6zqqo8yr4qz","timestamp":1705337632968,"id":"xtdcscwylcqe14u"}
{"type":"operationStart","subtype":"render","name":"locations-main","previousOperationId":"oifr6zqqo8yr4qz","timestamp":1705337632983,"id":"zmkvwehcmq2880v","previousEventId":"m9sppcvvs9r9kqn","operationId":"92gx4xtgea7rv50"}
{"type":"log","timestamp":1705337632983,"level":"info","message":"Starting rendering request 28","meta":{"rootId":"dmntf52byefemkg","id":"dmntf52byefemkg"},"id":"kkozpszxuxi2gom","previousOperationId":"92gx4xtgea7rv50"}
{"type":"log","timestamp":1705337632984,"level":"info","message":"Rendering template { name: locations-main, recipe: chrome-pdf, engine: handlebars, preview: true }","meta":{"rootId":"dmntf52byefemkg","id":"dmntf52byefemkg"},"id":"rezvf21vrpykfdz","previousOperationId":"92gx4xtgea7rv50"}
{"type":"log","timestamp":1705337632988,"level":"debug","message":"Data item not defined for this template.","meta":{"rootId":"dmntf52byefemkg","id":"dmntf52byefemkg"},"id":"0u73gumrauhmfm5","previousOperationId":"92gx4xtgea7rv50"}
{"type":"log","timestamp":1705337632992,"level":"debug","message":"Executing script locations-script (beforeRender)","meta":{"rootId":"dmntf52byefemkg","id":"dmntf52byefemkg"},"id":"tsfaa0dd4umehuh","previousOperationId":"92gx4xtgea7rv50"}
{"type":"log","timestamp":1705337633018,"level":"warn","message":"Error when processing render request 28\n(because) error when evaluating custom script /samples/Locations/locations-script\nPrivate field '#each' must be declared in an enclosing class\nsandbox.js:65\n    {{#each locations}}\n     ^\n\nSyntaxError: Private field '#each' must be declared in an enclosing class\n    at new Script (node:vm:94:7)\n    at doCompileScript (C:\\Users\\arida\\Dev\\2DAM\\EventFlow\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:154:10)\n    at run (C:\\Users\\arida\\Dev\\2DAM\\EventFlow\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:135:74)\n    at WorkerReporter.runInSandbox [as _runInSandbox] (C:\\Users\\arida\\Dev\\2DAM\\EventFlow\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\runInSandbox.js:195:20)","meta":{"rootId":"dmntf52byefemkg","id":"dmntf52byefemkg"},"id":"8ukqbcr03zd9mtb","previousOperationId":"92gx4xtgea7rv50"}
{"type":"log","timestamp":1705337633018,"level":"warn","message":"Rendering request 28 finished with error in 52 ms","meta":{"rootId":"dmntf52byefemkg","id":"dmntf52byefemkg"},"id":"9nt6mumxbxnxdws","previousOperationId":"92gx4xtgea7rv50"}
{"type":"error","timestamp":1705337633024,"statusCode":400,"weak":true,"entity":{"shortid":"BJX1Jw82ce","name":"locations-script","content":"// server side script fetching remote data and preparing report data source\nconst http = require(\"http\");\n\n// call remote http rest api\nfunction fetchLocations() {\n  return new Promise((resolve, reject) => {\n    http.get(\n      \"http://localhost:8080/api/locations/count-localizaciones\",\n      (result) => {\n        let str = \"\";\n\n        result.on(\"data\", (chunk) => {\n          str += chunk;\n        });\n\n        result.on(\"error\", (err) => {\n          reject(err);\n        });\n\n        result.on(\"end\", () => {\n          try {\n            const parsedData = JSON.parse(str);\n            // Verificar que 'localizaciones' existe en la respuesta JSON\n            if (parsedData && parsedData.localizaciones) {\n              resolve(parsedData.localizaciones);\n            } else {\n              reject(\n                new Error(\"El formato de la respuesta no es el esperado.\")\n              );\n            }\n          } catch (error) {\n            reject(error);\n          }\n        });\n      }\n    );\n  });\n}\n\n// group the data for report\nasync function prepareDataSource() {\n  try {\n    const locations = await fetchLocations();\n    const source = locations.map((location) => ({\n      name: location.name,\n      numEventos: location.numEvento,\n    }));\n    console.log(\"adiossssssssssssssssssssssssssssssssssssssss\")\n    return source;\n  } catch (error) {\n    console.error(\"Error al obtener ubicaciones:\", error.message);\n    throw error;\n  }\n}\n\n// add jsreport hook which modifies the report input data\nasync function beforeRender(req, res) {\n  req.data.locations = await prepareDataSource();\n  grafico();\n}\n\nfunction grafico(){\n    console.log(\"hola holitahhhhhhhhhhhhhhhhhhhhhhhhhhhhhh\")\n    var eventsByLocationsData = [];\n    {{#each locations}}\n      var name = '{{name}}';\n      var numEvents = {{numEvents}};\n      eventsByLocationsData.push({ name: name, numEvents: numEvents });\n      console.log(name); // Imprime el nombre en la consola\n    {{/each}}\n\n    var labels = eventsByLocationsData.map(entry => entry.name);\n    var data = eventsByLocationsData.map(entry => entry.numEvents);\n\n    // Configuración del gráfico de barras\n    var ctx = document.getElementById('eventsLocations').getContext('2d');\n    var eventsLocationsChart = new Chart(ctx, {\n        type: 'bar',\n        data: {\n            labels: labels,\n            datasets: [{\n                label: 'Total de eventos',\n                backgroundColor: 'rgba(75, 192, 192, 0.2)',\n                borderColor: 'rgba(75, 192, 192, 1)',\n                borderWidth: 1,\n                data: data\n            }]\n        },\n        options: {\n            animation: { duration: 0 },\n            scales: {\n                yAxes: [{\n                    ticks: {\n                        beginAtZero: true\n                    }\n                }]\n            }\n        }\n    });\n}\n"},"property":"content","logged":true,"previousOperationId":"92gx4xtgea7rv50","id":"si3l37j4x2xidcr","stack":"sandbox.js:65\n    {{#each locations}}\n     ^\n\nSyntaxError: Private field '#each' must be declared in an enclosing class\n    at new Script (node:vm:94:7)\n    at doCompileScript (C:\\Users\\arida\\Dev\\2DAM\\EventFlow\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:154:10)\n    at run (C:\\Users\\arida\\Dev\\2DAM\\EventFlow\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:135:74)\n    at WorkerReporter.runInSandbox [as _runInSandbox] (C:\\Users\\arida\\Dev\\2DAM\\EventFlow\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\runInSandbox.js:195:20)","message":"Error when evaluating custom script /samples/Locations/locations-script\nPrivate field '#each' must be declared in an enclosing class"}
